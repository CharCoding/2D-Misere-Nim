"use strict";function ba(a){var d=0;return function(){return d<a.length?{done:!1,value:a[d++]}:{done:!0}}}function u(a){var d="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return d?d.call(a):{next:ba(a)}}function v(a){if(!(a instanceof Array)){a=u(a);for(var d,e=[];!(d=a.next()).done;)e.push(d.value);a=e}return a}
var x=!1,y=2,z=Array(6),A=[73,978,14683,15259,16347,21403,22491,22747,24027,25435,27355,28635,30555,31707,32091,32475,32667,59164,91804,104867,115619,121315,124764,125411,151388,160476,163804,169443,170467,173404,181219,181731,182108,189276,190364,193116,196579,202979,206044,209891,213731,214748,216668,218083,221916,222684,235427,235875,236451,238435,239324,239971,243683,246627,248547,249059,253916,257507,261084,261724,261987,811812,919332,926052,942500,942948,944036,1335972,1443492,1450212,1467108,
1467812,1598052,1599268,1705572,1713380,1722276,1728996,1729892,1730212,1730532,1860452,1861540,1967972,1975140,1975716,1976036,1991268,1991588,1992164,1992484,2384292,2385828,2491812,2500068,2639652,2646372,2753892,2770788,2778532,2901924,2909092,2909988,3016612,3024228,3039716,3041124,3163812,3170532,3278052,3294628,3294948,3302884,3432932,3434148,3540452,3547620,3548388,3557284,3565284,3688164,3695332,3696036,3696484,3802852,3810788,3818980,3819108,3826916,3827620,3957732,4065252,4089252,4089828],
C=[],E=[];function ca(a){return a.map(function(a){return a.slice()})}function da(a){return a.reduce(function(a,e){return a+e})}function ea(a){return a.split("/").map(function(a){return Uint8Array.from(a)})}function F(a){for(var d=0,e=A.length-1,f,b;d<=e;)if(f=d+e>>>1,b=A[f],b<a)d=f+1;else if(b>a)e=f-1;else return f;return-d-1}for(var I=0,J=0,K=0,L=0,M=!1,N=c.getContext("2d"),O=6;O--;)z[O]=(new Uint8Array(6)).fill(1);N.strokeStyle="#ccc";N.font="24px Arial";N.textAlign="center";N.textBaseline="middle";
N.lineWidth=2;function P(a){if(!a.length)return 0;"string"==typeof a&&(a=ea(a));for(var d=0,e=u(a),f=e.next();!f.done;f=e.next()){f=u(f.value);for(var b=f.next();!b.done;b=f.next())d=2*d+b.value}return 64*d+8*a.length+a[0].length}
function Q(a,d,e){d=void 0===d?[]:d;e=void 0===e?[]:e;if(0==a[0].length)return 0;d.length=e.length=0;a=a.filter(function(a,b){return da(a)&&d.push(b)}).map(function(a){return Array.from(a)});if(!a.length)return a;for(var f=a[0].length;f--;){for(var b=!1,l=u(a),h=l.next();!h.done;h=l.next())if(h.value[f]){b=!0;e.unshift(f);break}if(!b)for(b=u(a),h=b.next();!h.done;h=b.next())h.value.splice(f,1)}return a}
function fa(){for(var a=Math.min(J,L)/50>>>1,d=Math.max(I,K)/50-1>>>1,e=Math.max(J,L)/50-1>>>1,f=[],b=Math.min(I,K)/50>>>1;b<=d;b++)for(var l=a;l<=e;l++)z[b][l]&&(z[b][l]=0,f.push(b,l));f.length&&(C.push(f),E.length=0);return f.length}function R(){if(localStorage.a)for(var a=localStorage.a.split(","),d=a.length;--d;){var e=a[d],f=F(e);0>f&&A.splice(-f-1,0,e)}else localStorage.a=""}
function S(a){a=void 0===a?+load.value:a;"object"==typeof a&&(a=+load.value);if(!(9>a)){T();var d=a,e=d&7;a=Array(d>>>3&7);d=Math.floor(d/64);for(var f=a.length;f--;){a[f]=new Uint8Array(e);for(var b=a[f].length;b--;)a[f][b]=d&1,d=Math.floor(d/2)}for(d=6;d--;)if(a[d])for(e=6;e--;)z[d][e]=a[d][e]||0;else z[d].fill(0);load.value="";U()}}function V(){if(C.length){y--;for(var a=C.pop(),d=0;d<a.length;d+=2)z[a[d]][a[d+1]]=1;E.push(a);U()}}
function W(){if(E.length){y++;for(var a=E.pop(),d=0;d<a.length;d+=2)z[a[d]][a[d+1]]=0;C.push(a);U()}}function T(){z.forEach(function(a){return a.fill(1)});C.length=E.length=0;y=2;current.value=4398046511094;info.textContent="(?, ?), (?, ?), %50";X()}function U(){current.value=P(Q(z));X()}function Y(){for(var a=[],d=6;d--;)for(var e=6;e--;)z[d][e]&&a.push([d,e]);return a[Math.random()*a.length|0]}
function Z(a,d){var e=[],f=[];if(d<+lvl.value){var b=a;e.push.apply(e,v(a.keys()));f.push.apply(f,v(a[0].keys()))}else b=Q(a,e,f);if(!e.length)return["?","?","?","?",-1,"EmptyW"];var l=P(b),h=F(l),g=new Uint8Array(8),m=b.length-1,t=b[0].length-1,k=e[0],q=f[0],n=e[m],B=f[t];if(0==m)return 0==t?[k,q,k,q,2*A.length+1,"1x1L"]:[k,f[1],n,B,0,"nx1W"];if(0==t)return[e[1],q,n,B,0,"1xnW"];if(0<=h){for(l=m;--l;)for(k=t;--k;)if(b[l][k])return[e[l],f[k],e[l],f[k],2*A.length-h,"Dict"+h+"CL"];e=u(Y());k=e.next().value;
q=e.next().value;return[k,q,k,q,2*A.length-h,"Dict"+h+"RL"]}for(var p=m+1;p--;)g[0]=g[0]<<1|b[p][0],g[4]=g[4]<<1|b[p][1],g[5]=g[5]<<1|b[p][t-1],g[1]=g[1]<<1|b[p][t];for(p=t+1;p--;)g[2]=g[2]<<1|b[0][p],g[6]=g[6]<<1|b[1][p],g[7]=g[7]<<1|b[m-1][p],g[3]=g[3]<<1|b[m][p];for(b=8;b--;)p=g[b],p&=p-1,g[b]|=(0==p)+(0==(p&p-1))<<6;for(b=4;b--;)if(g[b]&128||g[b]&64&&g[b]==g[b|4]){h=2-(g[b]>>>7);switch(b){case 0:q=f[h];break;case 1:B=f[t-h];break;case 2:k=e[h];break;default:n=e[m-h]}return[k,q,n,B,h-1,h+"x"+h+
":"+(h-1<<2|b)+"W"]}if(g[0]&64&&g[0]==g[1])return[k,f[1],n,f[t-1],1,"2x2TBW"];if(g[2]&64&&g[2]==g[3])return[e[1],q,e[m-1],B,1,"2x2LRW"];if(1>d)return h=u(Y()),k=h.next().value,q=h.next().value,[k,q,k,q,A.length,"FastR"];t=A.length<<1;k=[];q=u(e);for(n=q.next();!n.done;n=q.next())for(n=n.value,B=u(f),m=B.next();!m.done;m=B.next())for(m=m.value,g=u(e),b=g.next();!b.done;b=g.next()){b=b.value;p=u(f);for(var w=p.next();!w.done;w=p.next()){w=w.value;var r;if(r=n>=b&&m>=w)if(b==n&&w==m)r=!!a[b][w];else{for(var D=
r=!0,G=!0,aa=!0,H=m;H>=w;H--)a[b][H]&&(r=!1),a[n][H]&&(D=!1);for(H=n;H>=b;H--)a[H][w]&&(G=!1),a[H][m]&&(aa=!1);r=!(r||D||G||aa)}if(r){r=ca(a);for(D=b;D<=n;D++)for(G=w;G<=m;G++)r[D][G]=0;r=Q(r);D=P(r);G=F(D);if(0<=G)return[b,w,n,m,G,"DictW"];16<(D&56)&&2<(D&7)&&(r=2*A.length-Z(r,d-1)[4],r<t?(t=r,k=[[b,w,n,m]]):r==t&&k.push([b,w,n,m]))}}}e=u(k[Math.random()*k.length|0]);k=e.next().value;q=e.next().value;n=e.next().value;B=e.next().value;return 2==d&&learning.checked&&t>A.length?(localStorage.a+=","+
l,A.splice(-h-1,0,l),[k,q,n,B,t,"BestL"]):[k,q,n,B,t,"BestR"]}c.addEventListener("mousedown",function(a){x||(I=K=a.offsetX,J=L=a.offsetY,M=!0)});c.addEventListener("mousemove",function(a){M&&!x&&(K=a.offsetX,L=a.offsetY)});
function ha(){M=!1;if(fa()){y++;if(z.every(function(a){return a.every(function(a){return!a})})){if(confirm("Player "+(1+(y&1))+" won in "+(y>>>1)+" moves!\nStart a new game?")&&(T(),auto.checked&&p1ai.checked)){var a=Y();ia(a.concat(a))}}else if(y&p2ai.checked||~y&p1ai.checked)a=Z(z,+lvl.value),info.textContent=analyze.checked?"("+a[0]+", "+a[1]+"), ("+a[2]+", "+a[3]+"), "+(A.length-a[4])+" ("+a[5]+")":"",auto.checked&&ia(a);current.value=P(Q(z))}X()}
c.addEventListener("mouseup",function(){M&&!x&&ha()});c.addEventListener("mouseout",function(){x||(M=!1,X())});once.addEventListener("click",function(){var a=Z(z,+lvl.value);info.textContent="("+a[0]+", "+a[1]+"), ("+a[2]+", "+a[3]+"), "+(A.length-a[4])+" ("+a[5]+")"});
learning.addEventListener("click",function(){learning.checked?confirm("This feature requires maximum AI strength and localStorage, consumes more memory and may decrease performance. Enable anyways?")?(lvl.value=2,R()):learning.checked=!1:confirm("Clear localStorage ("+localStorage.a.length+" bytes)?")&&(localStorage.a="")});undoBtn.addEventListener("click",V);redoBtn.addEventListener("click",W);
resetBtn.addEventListener("click",function(){var a=+current.value;(!a||4398046511094!=a&&confirm("Are you sure to restart the game?"))&&T()});load.addEventListener("click",S);load.addEventListener("blur",S);document.addEventListener("keydown",function(a){if(!a.ctrlKey)switch(a.keyCode){case 82:a=+current.value;(!a||4398046511094!=a&&confirm("Are you sure to restart the game?"))&&T();break;case 90:V();break;case 89:W()}});
function X(){N.clearRect(0,0,650,650);for(var a=Math.min(I,K),d=Math.min(J,L),e=Math.max(I,K),f=Math.max(J,L),b=6;b--;)for(var l=6;l--;){var h=50*(b<<1|1),g=50*(l<<1|1);z[b][l]&&(N.fillStyle=M&&a<h+50&&h<e&&d<g+50&&g<f?"#999":"#eee",N.fillRect(h,g,50,50));N.fillStyle="#555";N.fillText(b+", "+l,h+25,g+25)}N.fillText((x?"AI":"Player")+" "+((y&1)+1)+", move "+(y>>1),325,625);M&&N.strokeRect(I,J,K-I,L-J)}X();function ja(){(M||x)&&X();requestAnimationFrame(ja)}
function ia(a){M=!0;I=K=100*a[0]+20;J=L=100*a[1]+20;var d=100*a[2]+130,e=100*a[3]+130;x=setInterval(function(){K<d&&K++;L<e&&L++;K==d&&L==e&&(clearInterval(x),x=!1,ha())},4)}learning.checked&&R();requestAnimationFrame(ja);