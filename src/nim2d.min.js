"use strict";function aa(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function v(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:aa(a)}}function w(a){if(!(a instanceof Array)){a=v(a);for(var b,e=[];!(b=a.next()).done;)e.push(b.value);a=e}return a}var x="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,ba="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,e){a!=Array.prototype&&a!=Object.prototype&&(a[b]=e.value)};function y(a,b){if(b){for(var e=x,f=a.split("."),d=0;d<f.length-1;d++){var h=f[d];h in e||(e[h]={});e=e[h]}f=f[f.length-1];d=e[f];h=b(d);h!=d&&null!=h&&ba(e,f,{configurable:!0,writable:!0,value:h})}}y("Promise",function(a){function b(a){this.f=0;this.j=void 0;this.c=[];var b=this.h();try{a(b.resolve,b.reject)}catch(t){b.reject(t)}}function e(){this.a=null}function f(a){return a instanceof b?a:new b(function(b){b(a)})}if(a)return a;e.prototype.l=function(a){if(null==this.a){this.a=[];var b=this;this.m(function(){b.v()})}this.a.push(a)};var d=x.setTimeout;e.prototype.m=function(a){d(a,0)};e.prototype.v=function(){for(;this.a&&this.a.length;){var a=this.a;this.a=[];for(var b=0;b<a.length;++b){var d=a[b];a[b]=null;try{d()}catch(n){this.u(n)}}}this.a=null};e.prototype.u=function(a){this.m(function(){throw a;})};b.prototype.h=function(){function a(a){return function(e){d||(d=!0,a.call(b,e))}}var b=this,d=!1;return{resolve:a(this.B),reject:a(this.i)}};b.prototype.B=function(a){if(a===this)this.i(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof b)this.C(a);else{a:switch(typeof a){case "object":var d=null!=a;break a;case "function":d=!0;break a;default:d=!1}d?this.A(a):this.o(a)}};b.prototype.A=function(a){var b=void 0;try{b=a.then}catch(t){this.i(t);return}"function"==typeof b?this.D(b,a):this.o(a)};b.prototype.i=function(a){this.s(2,a)};b.prototype.o=function(a){this.s(1,a)};b.prototype.s=function(a,b){if(0!=this.f)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.f);this.f=a;this.j=b;this.w()};b.prototype.w=function(){if(null!=this.c){for(var a=0;a<this.c.length;++a)h.l(this.c[a]);this.c=null}};var h=new e;b.prototype.C=function(a){var b=this.h();a.g(b.resolve,b.reject)};b.prototype.D=function(a,b){var d=this.h();try{a.call(b,d.resolve,d.reject)}catch(n){d.reject(n)}};b.prototype.then=function(a,d){function e(a,b){return"function"==typeof a?function(b){try{f(a(b))}catch(u){g(u)}}:b}var f,g,k=new b(function(a,b){f=a;g=b});this.g(e(a,f),e(d,g));return k};b.prototype["catch"]=function(a){return this.then(void 0,a)};b.prototype.g=function(a,b){function d(){switch(e.f){case 1:a(e.j);break;case 2:b(e.j);break;default:throw Error("Unexpected state: "+e.f);}}var e=this;null==this.c?h.l(d):this.c.push(d)};b.resolve=f;b.reject=function(a){return new b(function(b,d){d(a)})};b.race=function(a){return new b(function(b,d){for(var e=v(a),g=e.next();!g.done;g=e.next())f(g.value).g(b,d)})};b.all=function(a){var d=v(a),e=d.next();return e.done?f([]):new b(function(a,b){function g(b){return function(d){h[b]=d;k--;0==k&&a(h)}}var h=[],k=0;do h.push(void 0),k++,f(e.value).g(g(h.length-1),b),e=d.next();while(!e.done)})};return b});y("Promise.prototype.finally",function(a){return a?a:function(a){return this.then(function(b){return Promise.resolve(a()).then(function(){return b})},function(b){return Promise.resolve(a()).then(function(){throw b;})})}});var z=!1,A=2,B=Array(6),D=[73,978,14683,15259,16347,21403,22491,22747,24027,25435,27355,28635,30555,31707,32091,32475,32667,59164,91804,104867,115619,121315,124764,125411,151388,160476,163804,169443,170467,173404,181219,181731,182108,189276,190364,193116,196579,202979,206044,209891,213731,214748,216668,218083,221916,222684,235427,235875,236451,238435,239324,239971,243683,246627,248547,249059,253916,257507,261084,261724,261987,811812,919332,926052,942500,942948,944036,1335972,1443492,1450212,1467108,1467812,1598052,1599268,1705572,1713380,1722276,1728996,1729892,1730212,1730532,1860452,1861540,1967972,1975140,1975716,1976036,1991268,1991588,1992164,1992484,2384292,2385828,2491812,2500068,2639652,2646372,2753892,2770788,2778532,2901924,2909092,2909988,3016612,3024228,3039716,3041124,3163812,3170532,3278052,3294628,3294948,3302884,3432932,3434148,3540452,3547620,3548388,3557284,3565284,3688164,3695332,3696036,3696484,3802852,3810788,3818980,3819108,3826916,3827620,3957732,4065252,4089252,4089828],E=[],F=[];function ca(a){return a.map(function(a){return a.slice()})}function da(a){return a.split("/").map(function(a){return Uint8Array.from(a)})}function G(a){for(var b=0,e=D.length-1,f,d;b<=e;)if(f=b+e>>>1,d=D[f],d<a)b=f+1;else if(d>a)e=f-1;else return f;return-b-1}for(var K=0,L=0,M=0,N=0,O=!1,P=c.getContext("2d"),Q=6;Q--;)B[Q]=(new Uint8Array(6)).fill(1);P.strokeStyle="#ccc";P.font="24px Arial";P.textAlign="center";P.textBaseline="middle";P.lineWidth=2;function R(a){if(!a.length)return 0;"string"==typeof a&&(a=da(a));for(var b=0,e=v(a),f=e.next();!f.done;f=e.next()){f=v(f.value);for(var d=f.next();!d.done;d=f.next())b=2*b+d.value}return 64*b+8*a.length+a[0].length}function S(a,b,e){b=void 0===b?[]:b;e=void 0===e?[]:e;if(0==a[0].length)return 0;b.length=e.length=0;a=a.filter(function(a,d){return a.some(function(a){return a})&&b.push(d)}).map(function(a){return Array.from(a)});if(!a.length)return a;for(var f=a[0].length;f--;){for(var d=!1,h=v(a),k=h.next();!k.done;k=h.next())if(k.value[f]){d=!0;e.unshift(f);break}if(!d)for(d=v(a),k=d.next();!k.done;k=d.next())k.value.splice(f,1)}return a}function ea(){for(var a=Math.min(L,N)/50>>>1,b=Math.max(K,M)/50-1>>>1,e=Math.max(L,N)/50-1>>>1,f=[],d=Math.min(K,M)/50>>>1;d<=b;d++)for(var h=a;h<=e;h++)B[d][h]&&(B[d][h]=0,f.push(d,h));f.length&&(E.push(f),F.length=0);return f.length}function T(){if(localStorage.b)for(var a=localStorage.b.split(","),b=a.length;--b;){var e=a[b],f=G(e);0>f&&D.splice(-f-1,0,e)}else localStorage.b=""}function U(a){"number"!=typeof a&&(a=+load.value);if(!(9>a)){V();var b=a,e=b&7;a=Array(b>>>3&7);b=Math.floor(b/64);for(var f=a.length;f--;){a[f]=new Uint8Array(e);for(var d=a[f].length;d--;)a[f][d]=b&1,b=Math.floor(b/2)}for(b=6;b--;)if(a[b])for(e=6;e--;)B[b][e]=a[b][e]||0;else B[b].fill(0);load.value="";W()}}function ha(){z&&(clearInterval(z),O=z=!1,X(),info.textContent+="; AI stopped.")}function ia(){if(E.length){A--;for(var a=E.pop(),b=0;b<a.length;b+=2)B[a[b]][a[b+1]]=1;F.push(a);W()}}function ja(){if(F.length){A++;for(var a=F.pop(),b=0;b<a.length;b+=2)B[a[b]][a[b+1]]=0;E.push(a);W()}}function V(){B.forEach(function(a){return a.fill(1)});E.length=F.length=0;A=2;current.value=4398046511094;info.textContent="";if(auto.checked&&p1ai.checked){var a=Y();ka(a.concat(a));analyze.checked&&(info.textContent="("+a.join(", ")+"), ("+a.join(", ")+"), 0 (FastR)")}X()}function W(){current.value=R(S(B));X()}function Y(){for(var a=[],b=6;b--;)for(var e=6;e--;)B[b][e]&&a.push([b,e]);return a[Math.random()*a.length|0]}function la(a,b){var e=[],f=[];if(b<+lvl.value){var d=a;e.push.apply(e,w(a.keys()));f.push.apply(f,w(a[0].keys()))}else d=S(a,e,f);if(!e.length)return[-1,-1,-1,-1,-1,"EmptyW"];var h=R(d),k=G(h),g=new Uint8Array(8),t=d.length-1,n=d[0].length-1,m=e[0],l=f[0],J=e[t],q=f[n];if(0==t)return 0==n?[m,l,m,l,2*D.length+1,"1x1L"]:[m,f[1],J,q,0,"nx1W"];if(0==n)return[e[1],l,J,q,0,"1xnW"];if(0<=k){for(h=t;--h;)for(m=n;--m;)if(d[h][m])return[e[h],f[m],e[h],f[m],2*D.length-k,"Dict"+k+"CL"];e=v(Y());m=e.next().value;l=e.next().value;return[m,l,m,l,2*D.length-k,"Dict"+k+"RL"]}for(var p=t+1;p--;)g[0]=g[0]<<1|d[p][0],g[4]=g[4]<<1|d[p][1],g[5]=g[5]<<1|d[p][n-1],g[1]=g[1]<<1|d[p][n];for(p=n+1;p--;)g[2]=g[2]<<1|d[0][p],g[6]=g[6]<<1|d[1][p],g[7]=g[7]<<1|d[t-1][p],g[3]=g[3]<<1|d[t][p];for(d=8;d--;)p=g[d],p&=p-1,g[d]|=(0==p)+(0==(p&p-1))<<6;for(d=4;d--;)if(g[d]&128||g[d]&64&&g[d]==g[d|4]){k=2-(g[d]>>>7);switch(d){case 0:l=f[k];break;case 1:q=f[n-k];break;case 2:m=e[k];break;default:J=e[t-k]}return[m,l,J,q,k-1,k+"x"+k+":"+(k-1<<2|d)+"W"]}if(g[0]&64&&g[0]==g[1])return[m,f[1],J,f[n-1],1,"2x2TBW"];if(g[2]&64&&g[2]==g[3])return[e[1],l,e[t-1],q,1,"2x2LRW"];if(1>b)return e=v(Y()),m=e.next().value,l=e.next().value,[m,l,m,l,D.length,"FastR"];n=D.length<<1;m=[];t=v(e);for(l=t.next();!l.done;l=t.next())for(l=l.value,J=v(f),q=J.next();!q.done;q=J.next())for(q=q.value,g=v(e),d=g.next();!d.done;d=g.next()){d=d.value;p=v(f);for(var u=p.next();!u.done;u=p.next()){u=u.value;var r;if(r=l>=d&&q>=u)if(d==l&&u==q)r=!!a[d][u];else{for(var C=r=!0,H=!0,fa=!0,I=q;I>=u;I--)a[d][I]&&(r=!1),a[l][I]&&(C=!1);for(I=l;I>=d;I--)a[I][u]&&(H=!1),a[I][q]&&(fa=!1);r=!(r||C||H||fa)}if(r){r=ca(a);for(C=d;C<=l;C++)for(H=u;H<=q;H++)r[C][H]=0;r=S(r);C=R(r);H=G(C);if(0<=H)return[d,u,l,q,H,"DictW"];16<(C&56)&&2<(C&7)&&(r=2*D.length-la(r,b-1)[4],r<n?(n=r,m=[[d,u,l,q]]):r==n&&m.push([d,u,l,q]))}}}return 2==b&&learning.checked&&n>D.length?(localStorage.b+=","+h,D.splice(-k-1,0,h),m[Math.random()*m.length|0].concat([n,"BestL"])):m[Math.random()*m.length|0].concat([n,"BestR"])}function Z(){var a=la(B,+lvl.value);0>a[0]||(info.textContent=analyze.checked?"("+a[0]+", "+a[1]+"), ("+a[2]+", "+a[3]+"), "+(D.length-a[4])+" ("+a[5]+")":"",auto.checked&&ka(a))}c.addEventListener("mousedown",function(a){z||(K=M=a.offsetX,L=N=a.offsetY,O=!0)});c.addEventListener("mousemove",function(a){O&&!z&&(M=a.offsetX,N=a.offsetY)});function ma(){O=!1;ea()&&(A++,B.every(function(a){return a.every(function(a){return!a})})?confirm("Player "+(1+(A&1))+" won in "+(A>>>1)+" moves!\nStart a new game?")&&V():(A&p2ai.checked||~A&p1ai.checked)&&Z(),current.value=R(S(B)));X()}c.addEventListener("mouseup",function(){O&&!z&&ma()});c.addEventListener("mouseout",function(){z||(O=!1,X())});p1ai.addEventListener("input",function(){~A&p1ai.checked&&Z()});p2ai.addEventListener("input",function(){A&p2ai.checked&&Z()});once.addEventListener("click",Z);learning.addEventListener("click",function(){learning.checked?confirm("This feature requires maximum AI strength and localStorage, consumes more memory and may decrease performance. Enable anyways?")?(lvl.value=2,T()):learning.checked=!1:confirm("Clear localStorage ("+localStorage.b.length+" bytes)?")&&(localStorage.b="")});stopBtn.addEventListener("click",ha);undoBtn.addEventListener("click",ia);redoBtn.addEventListener("click",ja);resetBtn.addEventListener("click",function(){var a=+current.value;(!a||4398046511094!=a&&confirm("Are you sure to restart the game?"))&&V()});load.addEventListener("click",U);load.addEventListener("blur",U);document.addEventListener("keydown",function(a){if(!a.ctrlKey)switch(a.keyCode){case 79:Z();break;case 82:a=+current.value;(!a||4398046511094!=a&&confirm("Are you sure to restart the game?"))&&V();break;case 83:ha();break;case 89:ja();break;case 90:ia()}});function X(){P.clearRect(0,0,650,650);for(var a=Math.min(K,M),b=Math.min(L,N),e=Math.max(K,M),f=Math.max(L,N),d=6;d--;)for(var h=6;h--;){var k=50*(d<<1|1),g=50*(h<<1|1);B[d][h]&&(P.fillStyle=O&&a<k+50&&k<e&&b<g+50&&g<f?"#999":"#eee",P.fillRect(k,g,50,50));P.fillStyle="#666";P.fillText(d+", "+h,k+25,g+25)}P.fillText((z?"AI":"Player")+" "+((A&1)+1)+", move "+(A>>1),325,625);O&&P.strokeRect(K,L,M-K,N-L)}X();function na(){(O||z)&&X();requestAnimationFrame(na)}function ka(a){O=!0;K=M=50*(2*a[0]+.6);L=N=50*(2*a[1]+.6);var b=50+Math.ceil(32*Math.hypot(a[2]-a[0],a[3]-a[1])),e=(50*(2*a[2]+2.4)-K)/b,f=(50*(2*a[3]+2.4)-L)/b;z=setInterval(function(){M+=e;N+=f;b--||(clearInterval(z),z=!1,ma())})}learning.checked&&T();requestAnimationFrame(na);